
<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
    <title>编辑车辆信息</title>
    <link rel="stylesheet" href="css/weui.css"/>
    <link rel="stylesheet" href="css/example.css"/>
      <script type="text/javascript" src="js/util.js"></script>
<!--       <script src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>
 --></head>
<body>


	<header class="home_nav flex row item">
    <div class="logo">
            <h1>
                <img onclick="javascript:window.history.go(-1);" style="width:20px;height:20px;" src="image/truck/back.png"></img>
                <p class="city" ttname="wap_nav_city" href="javascript:void(0);">编辑车辆信息</p>
            </h1>
    </div>
    </header>

    <div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>

    <div class="container" id="container">
    
    
  <div class="page form_page js_show">
  <div class="weui-form">
    <div class="weui-form__control-area" style="margin: -30px 0;">
      <div class="weui-cells__group weui-cells__group_form">
        <div class="weui-cells__title">
        
        
        </div>
        <div class="weui-cells weui-cells_form">
          <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">车辆概况</label></div>
            <div class="weui-cell__bd">
            
            <textarea class="weui-textarea" id="nameTitle" placeholder="品牌、车型描述" rows="3"></textarea>
                <!-- <input id="nameTitle" class="weui-input" placeholder="品牌、车型描述" > -->
            </div>
          </div>
          
          <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">价格(万)</label></div>
            <div class="weui-cell__bd">
                <input id="price" class="weui-input" placeholder="估价">
            </div>
          </div>
          
          
           <!-- <div class="weui-cell weui-cell_access weui-cell_select weui-cell_select-after">
            <div class="weui-cell__hd"><label class="weui-label">类型</label></div>
            <div class="weui-cell__bd" id="truckType"></div>
          </div> -->
          
           <div class="weui-cell weui-cell_access weui-cell_select weui-cell_select-after">
            <div class="weui-cell__hd"><label class="weui-label">车型</label></div>
            <div class="weui-cell__bd" id="truckType" >其他</div>
          </div>
          
            <div class="weui-cell weui-cell_access weui-cell_select weui-cell_select-after">
            <div class="weui-cell__hd"><label class="weui-label">品牌</label></div>
            <div class="weui-cell__bd" id="truckLogo" >其他</div>
          </div>
          
          
          <div class="weui-cell weui-cell_switch">
                <div class="weui-cell__bd">有无户</div>
                <div class="weui-cell__ft">
                    <input class="weui-switch" type="checkbox" id="isGuohu">
                </div>
            </div>
            <div class="weui-cell weui-cell_access" id="showDatePicker1">
            <div class="weui-cell__bd">上牌时间</div>
            <div class="weui-cell__ft"></div>
          </div>
          <div class="weui-cell weui-cell_access" id="showDatePicker2">
            <div class="weui-cell__bd">年检时间</div>
            <div class="weui-cell__ft"></div>
          </div>
              <div class="weui-cell weui-cell_access" id="showDatePicker3">
            <div class="weui-cell__bd">交强险时间</div>
            <div class="weui-cell__ft"></div>
          </div>
             <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">行驶里程</label></div>
            <div class="weui-cell__bd">
                <input id="mile" class="weui-input" placeholder="万公里">
            </div>
          </div>
              <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">车龄(年)</label></div>
            <div class="weui-cell__bd">
                <input id="year" class="weui-input" placeholder="年">
            </div>
          </div>
          <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">联系电话</label></div>
            <div class="weui-cell__bd">
                <input id="phone" class="weui-input" placeholder="填写绑定的电话号码" type="number" pattern="[0-9]*">
            </div>
          </div>
          
          
          <div class="weui-cell weui-cell_access weui-cell_select weui-cell_select-after">
            <div class="weui-cell__hd"><label class="weui-label">身份</label></div>
            <div class="weui-cell__bd" id="showPicker">商家</div>
          </div>
          
         
          
          
            <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">看车地址</label></div>
            <div class="weui-cell__bd">
                <input id="address" class="weui-input" placeholder="">
            </div>
          </div>
           <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">详细内容</label></div>
            <div class="weui-cell__bd">
                <input id="remark" class="weui-input" placeholder="其他补充信息">
            </div>
          </div>
          
          
           <div class="weui-gallery" id="gallery">
            <span class="weui-gallery__img" id="galleryImg"></span>
            <div class="weui-gallery__opr">
                <a href="javascript:" class="weui-gallery__del">
                    <i class="weui-icon-delete weui-icon_gallery-delete"></i>
                </a>
            </div>
        </div>
          
          
        </div>
      </div>
    </div>
    
    <div class="weui-form__tips-area">
      <p class="weui-form__tips">
        提交发布后，后台会尽快完成审核
      </p>
    </div>
    
    
    <div class="button-sp-area" style="text-align:center;">
            <a style="width:30%" class="weui-btn weui-btn_primary weui-btn_mini" href="javascript:" id="publish">保存</a>
            <a style="width:30%" class="weui-btn weui-btn_primary weui-btn_mini" href="javascript:window.history.go(-1);" id="publish">返回</a>
   
        </div>
    
  <!--   <div class="weui-form__opr-area">
      <a style="width:30%" class="weui-btn weui-btn_primary weui-btn" href="javascript:" id="publish">保存</a>

    </div>
     -->
   
    
  </div>
  <div id="js_toast" style="display: none;">
      <div class="weui-mask_transparent"></div>
      <div class="weui-toast">
          <i class="weui-icon-success-no-circle weui-icon_toast"></i>
          <p class="weui-toast__content">已完成</p>
      </div>
  </div>
</div>
    
    
    </div>
    
    <script src="js/zepto.min.js"></script>
    <script type="text/javascript" src="js/jweixin-1.0.0.js"></script>
    <script src="js/weui.min.js"></script>
    <script src="js/example.js"></script>
 
    
    <script>
    var numberCode="";

    $(document).ready(function() {
    	numberCode =getUrlParam("numberCode");
    	
    	$.ajax({
    		url : "/WebWS/truckDetail.xyz",
    		type : "POST",
    		data : {
    			numberCode : numberCode
    		},
    		async : false,
    		dataType : "json",
    		success : function(data) {
    			if (data.status == 1) {
    				console.log(data);
    				var truckObj=data.content;
    				$("#nameTitle").val(truckObj.title);
    				$("#price").val(truckObj.price);
    				$("#mile").val(truckObj.mile);
    				$("#year").val(truckObj.year);
    				$("#phone").val(truckObj.phone);
    				$("#address").val(truckObj.address);
    				$("#remark").val(truckObj.remark);
    				$("#showDatePicker1").val("2020-01-01");
    				
    				if(truckObj.isGuohu==1){
    					$("#isGuohu").attr("checked","checked");
    				}
    				if(truckObj.type==0){
    					$("#showPicker").html("个人");
    				}else{
    					$("#showPicker").html("商家");
    				}
    				
    				if(truckObj.truckType=="QYC"){
    					$("#truckType").html("牵引车");
    				}else if(truckObj.truckType=="ZHC"){
    					$("#truckType").html("载货车");
    				}else if(truckObj.truckType=="ZXC"){
    					$("#truckType").html("自卸车");
    				}else{
    					$("#truckType").html("其他");
    				}
    				$("#truckLogo").html(truckObj.truckLogo);
    				var date = new Date(truckObj.cardDate);
    				$('#showDatePicker1').val(date .getFullYear()+"-"+(date .getMonth()+1)+"-"+date .getDate());
                	$('#showDatePicker1 .weui-cell__bd').append("&nbsp;&nbsp;&nbsp;&nbsp;"+date .getFullYear()+"年"+(date .getMonth()+1)+"月"+date .getDate()+"日");
    				
                	date = new Date(truckObj.checkDate);
                	$('#showDatePicker2').val(date .getFullYear()+"-"+(date .getMonth()+1)+"-"+date .getDate());
                	$('#showDatePicker2 .weui-cell__bd').append("&nbsp;&nbsp;&nbsp;&nbsp;"+date .getFullYear()+"年"+(date .getMonth()+1)+"月"+date .getDate()+"日");
    			 	
    			 	date = new Date(truckObj.insuranceDate);
    			 	$('#showDatePicker3').val(date .getFullYear()+"-"+(date .getMonth()+1)+"-"+date .getDate());
                	$('#showDatePicker3 .weui-cell__bd').append("&nbsp;&nbsp;&nbsp;&nbsp;"+date .getFullYear()+"年"+(date .getMonth()+1)+"月"+date .getDate()+"日");
    				
    			} else {
    				weui.alert(data.msg);
    			}
    		}
    	});
    	
    });
    

    
    $('#showDatePicker1').on('click', function () {
        weui.datePicker({
            start: 2000,
            end: 2050,
            defaultValue:[2020-02-02],
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
            	$('#showDatePicker1').val(result[0].value+"-"+result[1].value+"-"+result[2].value);
            	$('#showDatePicker1 .weui-cell__bd').html("");
            	$('#showDatePicker1 .weui-cell__bd').append("上牌时间&nbsp;&nbsp;&nbsp;&nbsp;"+result[0].value+"年"+result[1].value+"月"+result[2].value+"日");
            },
            title: '上牌时间'
        });
    });
    
    $('#showDatePicker2').on('click', function () {
        weui.datePicker({
            start: 2000,
            end: 2050,
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
            	$('#showDatePicker2').val(result[0].value+"-"+result[1].value+"-"+result[2].value);
            	$('#showDatePicker2 .weui-cell__bd').html("");
            	$('#showDatePicker2 .weui-cell__bd').append("年检时间&nbsp;&nbsp;&nbsp;&nbsp;"+result[0].value+"年"+result[1].value+"月"+result[2].value+"日");
            },
            title: '年检时间'
        });
    });
    
    $('#showDatePicker3').on('click', function () {
        weui.datePicker({
            start: 2000,
            end: 2050,
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
            	$('#showDatePicker3').val(result[0].value+"-"+result[1].value+"-"+result[2].value);
            	$('#showDatePicker3 .weui-cell__bd').html("");
            	$('#showDatePicker3 .weui-cell__bd').append("交强险时间&nbsp;&nbsp;&nbsp;&nbsp;"+result[0].value+"年"+result[1].value+"月"+result[2].value+"日");
            },
            title: '交强险时间'
        });
    });
    
    $('#showPicker').on('click', function () {
        weui.picker([{
            label: '个人',
            value: 1
        },{
            label: '商家',
            value: 0
        }], {
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
                console.log(result);
                $("#showPicker").html(result[0].label);
            },
            title: '身份'
        });
    });
    
    $('#truckType').on('click', function () {
        weui.picker([{
            label: '牵引车',
            value: 'QYC'
        },{
            label: '载货车',
            value: 'ZHC'
        },{
            label: '自卸车',
            value: 'ZXC'
        },{
            label: '其他',
            value: 'OTHER'
        }], {
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
                console.log(result);
                $("#truckType").html(result[0].label);
            },
            title: '类型'
        });
    });
    
    $('#truckLogo').on('click', function () {
        weui.picker([{
            label: '解放',
            value: '解放'
        },{
            label: '东风',
            value: '东风'
        },{
            label: '重汽',
            value: '重汽'
        },{
            label: '上汽红岩',
            value: '上汽红岩'
        },{
            label: '陕汽',
            value: '陕汽'
        },{
            label: '大运',
            value: '大运'
        },{
            label: '福田',
            value: '福田'
        },{
            label: '其他',
            value: '其他'
        }], {
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
                console.log(result);
                $("#truckLogo").html(result[0].label);
            },
            title: '车型'
        });
    });
    


$("#publish").click(function(){
	
	
	var title=$("#nameTitle").val();
	var price=$("#price").val();
	var isGuohu=$("#isGuohu").prop("checked")?1:0;
	var cardDate=$("#showDatePicker1").val();
	var checkDate=$("#showDatePicker2").val();
	var insuranceDate=$("#showDatePicker3").val();
	var mile=$("#mile").val();
	var year=$("#year").val();
	var phone=$("#phone").val();
	var type=$("#showPicker").html()=="个人"?0:1;
	var truckType=$("#truckType").html();
	if(truckType=="牵引车"){
		truckType="QYC";
	}else if(truckType=="载货车"){
		truckType="ZHC";
	}else if(truckType=="自卸车"){
		truckType="ZXC";
	}else{
		truckType="OTHER";
	}
	var truckLogo=$("#truckLogo").html();
	var address=$("#address").val();
	var remark=$("#remark").val();
	
	if(xyzIsNull(title)){
		weui.alert("车辆名称不能为空");
		return;
	}
	if(xyzIsNull(price)){
		weui.alert("车辆价格不能为空");
		return;
	}
	if(xyzIsNull(truckLogo)){
		weui.alert("车型不能为空");
		return;
	}
	if(xyzIsNull(insuranceDate)){
		weui.alert("交强险时间不能为空");
		return;
	}
	if(xyzIsNull(checkDate)){
		weui.alert("车检时间不能为空");
		return;
	}
	if(xyzIsNull(cardDate)){
		weui.alert("上牌时间不能为空");
		return;
	}
	if(xyzIsNull(mile)){
		weui.alert("里程不能为空");
		return;
	}
	if(xyzIsNull(year)){
		weui.alert("车龄不能为空");
		return;
	}
	if(xyzIsNull(phone)){
		weui.alert("联系电话不能为空");
		return;
	}
	
	var map={};
	map.title=title;
	map.price=price;
	map.isGuohu=isGuohu;
	map.cardDate=cardDate;
	map.checkDate=checkDate;
	map.insuranceDate=insuranceDate;
	map.mile=mile;
	map.year=year;
	map.phone=phone;
	map.type=type;
	map.truckType=truckType;
	map.truckLogo=truckLogo;
	map.address=address;
	map.remark=remark;
	
	console.log(map);
	
	$.ajax({
		url : "/TruckWS/editTruck.cus",
		type : "POST",
		data : {
			numberCode:numberCode,
			dataJson : JSON.stringify(map)
		},
		async : false,
		dataType : "json",
		success : function(data) {
			if (data.status == 1) {
				weui.alert("编辑成功");
				setTimeout(function(){
					history.go(-1);
				},"2000");
			} else {
				weui.alert(data.msg);
			}
		}
	});
	
});

</script>
    
</body>
</html>
